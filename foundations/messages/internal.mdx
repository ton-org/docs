---
title: "Internal Messages"
---

Internal messages are the messages sent from one contract to another. It is the most common type of message.

Internal message contents are as follows:

```tl-b
int_msg_info$0 ihr_disabled:Bool bounce:Bool bounced:Bool
  src:MsgAddressInt dest:MsgAddressInt
  value:CurrencyCollection extra_flags:(VarUInteger 16) fwd_fee:Grams
  created_lt:uint64 created_at:uint32 = CommonMsgInfo;

message$_ {X:Type} info:CommonMsgInfo
  init:(Maybe (Either StateInit ^StateInit))
  body:(Either X ^X) = Message X;
```

- `ihr_disabled` - This flag is unused and always set to `true`.
- `bounce` - Indicates whether the message is bounceable.
- `bounced` - Indicates whether the message has been bounced.
- `src` - the address of the contract that sent the message.
- `dest` - the address of the contract that received the message.
- `value` - the amount of Toncoin and extra-currency sent with the message.
- `extra_flags` - used with new bounce format.
- `fwd_fee` - the fee charged for forwarding the message.
- `created_lt` - the logical time when the message was created.
- `created_at` - the unix time when the message was created.

This is a structure of the message a contract may receive. However, the requirements for the contents of this structure are different when sending a message. These requirements are described by the relaxed version of the structure.

```tl-b
int_msg_info$0 ihr_disabled:Bool bounce:Bool bounced:Bool
  src:MsgAddress dest:MsgAddressInt
  value:CurrencyCollection extra_flags:(VarUInteger 16) fwd_fee:Grams
  created_lt:uint64 created_at:uint32 = CommonMsgInfoRelaxed;

message$_ {X:Type} info:CommonMsgInfoRelaxed
  init:(Maybe (Either StateInit ^StateInit))
  body:(Either X ^X) = MessageRelaxed X;
```

```tl-b
_ fixed_prefix_length:(Maybe (## 5)) special:(Maybe TickTock)
  code:(Maybe ^Cell) data:(Maybe ^Cell)
  library:(HashmapE 256 SimpleLib) = StateInitWithLibs;
```

The process of transforming the relaxed version of the structure into the strict version occurs in the action phase and is performed by [SENDMSG action](/foundations/actions/send). Also, this action rewrites some fields of the structure to correct values. That action also performs validation of the `StateInit` field against `StateInitWithLibs` type.

## Deployment of contracts

Thanks to the structure of the message, it is possible to send both the payload in `body` field and the StateInit in `init` field. So the contract can both be [initialized by StateInit](/foundations/messages/state-init) and process the payload in one transaction.

## Message value

The message may carry a value of Toncoin and extra-currency. The value is transferred from the sender to the recipient of the message. The value of this field is affected by [send modes](/foundations/messages/modes) contract uses.

## Bounces

Interesting feature of the internal messages are bounces. Bounce message is the message generated automatically by the network, when the original message resulted in an error in [compute phase](/foundations/phases#compute-phase), during its processing. It may also occur when the message resulted an error in [action phase](/foundations/phases#action-phase) and mode `SendBounceIfActionFail` (+16) is used.

### Default bounce

If the `bounce` flag is set to `true`, the message is bounceable. If the bounce conditions are met, the following transformation occurs:

- `src` and `dest` fields are swapped.
- `bounced` flag set is set to `true`.
- `bounce` flag set to `false`.
- `body` is replaced with concatenation of 32 bits equal to one (0xffffffff) and first 256 bits of the old `body`. The new `body` is stored in a message in-place, so Either = 0.

The new message is sent to the `src` address of the original message.

### New bounce format

Using the `extra_flags` field it is possible to change, how new `body` will be constructed. All other transformations remain the same.

`(extra_flags & 1) = 1` enables the new bounce format for the message. The bounced message contains information about the transaction.
If `(extra_flags & 3) = 3`, the bounced message contains the whole body of the original message. Otherwise, only the bits from the root of the original body are returned.

All other bits in `extra_flags` are reserved for future use and are not allowed now (internal messages with flags other than `0..3` are invalid).

When the message with a new bounce flag is bounced, the bounced message body has the following format (`new_bounce_body`):

```
_ value:CurrencyCollection created_lt:uint64 created_at:uint32 = NewBounceOriginalInfo;
_ gas_used:uint32 vm_steps:uint32 = NewBounceComputePhaseInfo;

new_bounce_body#fffffffe
    original_body:^Cell
    original_info:^NewBounceOriginalInfo
    bounced_by_phase:uint8 exit_code:int32
    compute_phase:(Maybe NewBounceComputePhaseInfo)
    = NewBounceBody;
```

- `original_body` - cell that contains the body of the original message. If `extra_flags & 2` then the whole body is returned, otherwise it is only the root without refs.
- `original_info` - value, lt and unixtime of the original message.
- `bounced_by_phase`:
- `0` - compute phase was skipped. `exit_code` denotes the skip reason:
- `exit_code = -1` - no state (an account is uninit or frozen, and no state init is present in the message).
- `exit_code = -2` - bad state (an account is uninit or frozen, and state init in the message has the wrong hash).
- `exit_code = -3` - no gas.
- `exit_code = -4` - account is suspended.
- `1` - compute phase failed. `exit_code` is the value from the compute phase.
- `2` - action phase failed. `exit_code` is the value from the action phase.
- `exit_code` - 32-bit exit code, see above.
- `compute_phase` - exists if it was not skipped (`bounced_by_phase > 0`):
- `gas_used`, `vm_steps` - same as in `TrComputePhase` of the transaction.

The bounced message has the same 0th and 1st bits in `extra_flags` as the original message.
